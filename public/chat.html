<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>NeoBot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { margin:0; background:#0b1220; font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif; color:#e5e7eb; display:flex; justify-content:center; align-items:center; min-height:100vh; }
    .app { width:100%; max-width:900px; height:90vh; min-height:500px; background:linear-gradient(180deg,#0f172a,#020617); border-radius:16px; display:flex; flex-direction:column; box-shadow:0 20px 60px rgba(0,0,0,.5); }
    header { padding:16px 20px; border-bottom:1px solid #1e293b; display:flex; align-items:center; gap:16px; flex-shrink:0; }
    header .dot { width:10px; height:10px; background:#22c55e; border-radius:50%; }
    header h1 { font-size:18px; margin:0; }
    nav { display:flex; gap:4px; }
    nav a { padding:8px 14px; border-radius:8px; color:#94a3b8; text-decoration:none; font-size:14px; font-weight:500; }
    nav a:hover { color:#e5e7eb; background:#1e293b; }
    nav a.active { color:#2563eb; background:#1e3a8a33; }
    .panel { display:none; flex:1; flex-direction:column; min-height:0; }
    .panel.active { display:flex; }
    .tip { font-size:13px; color:#94a3b8; padding:10px 20px; border-bottom:1px solid #020617; flex-shrink:0; }
    .messages { flex:1; padding:20px; overflow-y:auto; }
    .msg { max-width:70%; margin-bottom:16px; padding:14px 16px; border-radius:14px; line-height:1.4; white-space:pre-wrap; }
    .bot { background:#020617; border:1px solid #1e293b; }
    .user { background:#1e3a8a; margin-left:auto; }
    footer { display:flex; gap:10px; padding:16px; border-top:1px solid #1e293b; flex-shrink:0; }
    input[type="text"], input[type="search"] { flex:1; padding:14px; border-radius:12px; border:none; outline:none; background:#020617; color:#e5e7eb; font-size:15px; }
    button { padding:14px 20px; border-radius:12px; border:none; background:#2563eb; color:white; font-weight:600; cursor:pointer; font-size:14px; }
    button:hover { background:#1d4ed8; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    button.secondary { background:#1e293b; color:#e5e7eb; }
    button.secondary:hover { background:#334155; }
    button.danger { background:#991b1b; }
    button.danger:hover { background:#b91c1c; }

    /* SEO panel */
    #seo-panel .seo-content { flex:1; padding:20px; overflow-y:auto; display:flex; flex-direction:column; gap:24px; }
    .seo-form { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .seo-form input { min-width:200px; }
    .banner { padding:12px 16px; border-radius:12px; margin-bottom:12px; }
    .banner.error { background:#450a0a; border:1px solid #991b1b; color:#fca5a5; }
    .banner.info { background:#0c4a6e33; border:1px solid #0ea5e9; color:#7dd3fc; }
    .seo-job-card { background:#020617; border:1px solid #1e293b; border-radius:12px; padding:16px; }
    .seo-job-card h3 { margin:0 0 8px 0; font-size:14px; color:#94a3b8; }
    .seo-status { display:inline-block; padding:4px 10px; border-radius:8px; font-size:13px; font-weight:500; }
    .seo-status.queued { background:#422006; color:#fcd34d; }
    .seo-status.processing { background:#1e3a8a33; color:#93c5fd; }
    .seo-status.completed { background:#14532d; color:#86efac; }
    .seo-status.failed, .seo-status.cancelled, .seo-status.rejected { background:#450a0a; color:#fca5a5; }
    .seo-status.draft { background:#422006; color:#fcd34d; }
    .seo-status.approved { background:#1e3a8a33; color:#93c5fd; }
    .seo-status.blocked_by_robots { background:#451a03; color:#fdba74; }
    .seo-result-box { margin-top:12px; }
    .seo-result-box textarea { width:100%; min-height:200px; padding:14px; border-radius:12px; border:1px solid #1e293b; background:#020617; color:#e5e7eb; font-size:14px; line-height:1.5; resize:vertical; box-sizing:border-box; }
    .seo-history h3 { margin:0 0 12px 0; font-size:16px; }
    .seo-table-wrap { overflow-x:auto; }
    .seo-table { width:100%; border-collapse:collapse; font-size:14px; }
    .seo-table th, .seo-table td { padding:10px 12px; text-align:left; border-bottom:1px solid #1e293b; }
    .seo-table th { color:#94a3b8; font-weight:500; }
    .seo-table tr:hover { background:#0f172a; }
    .seo-table tr.clickable { cursor:pointer; }
    .seo-table .actions { display:flex; gap:8px; }
    .spinner { display:inline-block; width:18px; height:18px; border:2px solid #1e293b; border-top-color:#2563eb; border-radius:50%; animation:spin 0.8s linear infinite; }
    @keyframes spin { to { transform:rotate(360deg); } }
    .audit-report section { margin-top:16px; }
    .audit-report h4 { margin:0 0 8px 0; font-size:14px; color:#94a3b8; }
    .audit-report ul { margin:0; padding-left:20px; }
    .audit-report .issue { margin-bottom:8px; padding:8px; background:#0f172a; border-radius:8px; font-size:13px; }
    .audit-report .fix-row { margin-bottom:8px; padding:8px; background:#0f172a; border-radius:8px; font-size:13px; }
    .publish-connections { margin-bottom:24px; }
    .publish-connections h3 { margin:0 0 12px 0; font-size:16px; }
    .publish-card { background:#020617; border:1px solid #1e293b; border-radius:12px; padding:16px; margin-bottom:12px; max-width:480px; }
    .publish-card .form-row { margin-bottom:10px; }
    .publish-card label { display:block; color:#94a3b8; font-size:13px; margin-bottom:4px; }
    .publish-card input { width:100%; box-sizing:border-box; }
    .api-status { display:flex; align-items:center; gap:8px; margin-bottom:16px; }
    .api-status.offline .api-dot { background:#dc2626; }
    .api-dot { width:12px; height:12px; border-radius:50%; background:#22c55e; }
    .history-list .item { padding:10px 12px; border-bottom:1px solid #1e293b; cursor:pointer; }
    .history-list .item:hover { background:#0f172a; }
    .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,.7); display:flex; align-items:center; justify-content:center; z-index:100; }
    .modal { background:#0f172a; border:1px solid #1e293b; border-radius:12px; max-width:90%; max-height:80%; overflow:auto; padding:20px; }
    .modal h3 { margin:0 0 12px 0; }
    .modal-actions { margin-top:12px; display:flex; gap:8px; }
    .chat-layout { display:flex; flex:1; min-height:0; }
    .chat-sidebar { width:260px; flex-shrink:0; border-right:1px solid #1e293b; padding:12px; overflow-y:auto; }
    .chat-thread-list { display:flex; flex-direction:column; gap:4px; }
    .chat-thread-item { padding:10px 12px; border-radius:8px; text-align:left; cursor:pointer; background:transparent; border:none; color:#e5e7eb; font-size:14px; }
    .chat-thread-item:hover { background:#1e293b; }
    .chat-thread-item.active { background:#1e3a8a33; color:#93c5fd; }
    .chat-main { flex:1; display:flex; flex-direction:column; min-height:0; }
    .chat-toolbar { padding:8px 16px; border-bottom:1px solid #1e293b; display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
    .chat-toolbar select { padding:8px 12px; border-radius:8px; border:1px solid #1e293b; background:#020617; color:#e5e7eb; }
    .chat-profile-link { font-size:13px; color:#94a3b8; text-decoration:none; }
    .chat-profile-link:hover { color:#e5e7eb; }
    #chat-panel .messages { flex:1; }
    #chat-panel footer { flex-shrink:0; }
    .form-row { margin-bottom:14px; }
    .form-row label { display:block; color:#94a3b8; font-size:13px; margin-bottom:4px; }
    .form-row input, .form-row textarea { width:100%; padding:10px 12px; border-radius:8px; border:1px solid #1e293b; background:#020617; color:#e5e7eb; font-size:14px; box-sizing:border-box; }
    .form-row textarea { resize:vertical; min-height:80px; }
  </style>
</head>
<body>

<div class="app">
  <header>
    <div class="dot" id="header-dot"></div>
    <h1>NeoBot</h1>
    <nav>
      <a href="#" id="nav-dashboard" class="active">Dashboard</a>
      <a href="#" id="nav-chat">Chat</a>
      <a href="#" id="nav-marketing">Marketing</a>
      <a href="/brand">Profil firmy</a>
      <a href="#" id="nav-outputs">Výstupy</a>
      <a href="#" id="nav-history">Historie</a>
      <a href="#" id="nav-seo">SEO</a>
      <a href="#" id="nav-seo-audit">SEO Audit</a>
      <a href="#" id="nav-publish">Publish</a>
      <a href="/users">Uživatelé</a>
    </nav>
  </header>

  <div id="dashboard-panel" class="panel active">
    <div class="tip">Přehled a stav API.</div>
    <div class="seo-content" style="padding:20px;">
      <div class="form-row" style="max-width:480px; margin-bottom:16px;">
        <label>API klíč (pro Chat a Brand)</label>
        <span id="dashboard-api-key-masked" style="display:none; font-family:monospace; color:#94a3b8; margin-bottom:8px;"></span>
        <input type="password" id="dashboard-api-key" placeholder="nb_..." style="width:100%;" />
        <div style="margin-top:8px; display:flex; gap:8px;">
          <button type="button" id="dashboard-clear-api-key" class="secondary">Vymazat API klíč</button>
        </div>
      </div>
      <div class="api-status" id="api-status">
        <span class="api-dot" id="api-dot"></span>
        <span id="api-status-text">Kontroluji…</span>
      </div>
      <button type="button" id="test-api-btn" class="secondary">Test API</button>
      <section class="seo-history" style="margin-top:20px;" id="dashboard-usage-section">
        <h3>Využití</h3>
        <div id="dashboard-usage" style="color:#94a3b8;font-size:14px;">Načítám…</div>
      </section>
      <div id="api-debug" style="display:none;margin-top:16px;padding:12px;background:#020617;border-radius:8px;border:1px solid #1e293b;"></div>
      <section class="seo-history" style="margin-top:24px;">
        <h3>Poslední články</h3>
        <div id="dashboard-articles"></div>
      </section>
      <section class="seo-history" style="margin-top:16px;">
        <h3>Poslední audity</h3>
        <div id="dashboard-audits"></div>
      </section>
    </div>
  </div>

  <div id="chat-panel" class="panel">
    <div class="chat-layout">
      <aside class="chat-sidebar">
        <div class="tip">Vlákna (Chat + Brand Memory)</div>
        <button type="button" id="chat-new-btn" class="secondary" style="width:100%;margin-bottom:12px;">+ Nový chat</button>
        <div id="chat-thread-list" class="chat-thread-list"></div>
      </aside>
      <div class="chat-main">
        <div class="chat-toolbar">
          <select id="chat-mode">
            <option value="marketing">Marketing</option>
            <option value="general">Obecný</option>
          </select>
          <a href="/brand" class="chat-profile-link">Upravit profil firmy</a>
        </div>
        <div id="messages" class="messages"></div>
        <footer>
          <input id="input" placeholder="Napiš zprávu…" maxlength="3000" />
          <button id="sendBtn" type="button">Odeslat</button>
        </footer>
      </div>
    </div>
  </div>

  <div id="seo-panel" class="panel">
    <div class="tip">Vygeneruj SEO článek podle tématu. Výsledek se ukládá a je v historii.</div>
    <div class="seo-content">
      <div id="seo-banner" class="banner" style="display:none;"></div>
      <section class="seo-form-section">
        <div class="seo-form">
          <input type="text" id="seo-topic" placeholder="Téma článku (např. Jak zvýšit prodej)" />
          <button type="button" id="seo-generate-btn">Vygenerovat článek</button>
        </div>
      </section>
      <section id="seo-current-card" class="seo-job-card" style="display:none;">
        <h3>Aktuální job</h3>
        <p id="seo-current-jobid"></p>
        <p id="seo-current-status"></p>
        <div id="seo-progress-container" style="display:none; margin-top:12px;">
          <div style="display:flex; justify-content:space-between; margin-bottom:4px; font-size:13px; color:#94a3b8;">
            <span>Progress</span>
            <span id="seo-progress-text">0%</span>
          </div>
          <div style="width:100%; height:8px; background:#020617; border-radius:4px; overflow:hidden; border:1px solid #1e293b;">
            <div id="seo-progress-bar" style="width:0%; height:100%; background:#2563eb; transition:width 0.3s ease;"></div>
          </div>
        </div>
        <div id="seo-current-result" class="seo-result-box" style="display:none;">
          <textarea id="seo-result-text" readonly></textarea>
          <div style="display:flex; gap:8px; margin-top:8px;">
            <button type="button" id="seo-copy-btn" class="secondary">Copy</button>
            <button type="button" id="seo-publish-btn" class="secondary">Send to Publish Center (WP Draft)</button>
          </div>
        </div>
      </section>
      <section class="seo-history">
        <h3>Historie (posledních 20)</h3>
        <div id="seo-history-loading" class="spinner" style="display:none;"></div>
        <div class="seo-table-wrap">
          <table class="seo-table">
            <thead>
              <tr><th>Vytvořeno</th><th>Téma</th><th>Stav</th><th>Akce</th></tr>
            </thead>
            <tbody id="seo-history-tbody"></tbody>
          </table>
        </div>
      </section>
    </div>
  </div>

  <div id="seo-audit-panel" class="panel">
    <div class="tip">Zadej URL webu a spusť SEO audit. Respektujeme robots.txt a rate limit.</div>
    <div class="seo-content">
      <div id="audit-banner" class="banner" style="display:none;"></div>
      <section class="seo-form-section">
        <div class="seo-form">
          <input type="url" id="audit-url" placeholder="https://example.com" />
          <label style="color:#94a3b8;font-size:14px;">Max stránek</label>
          <input type="number" id="audit-max-pages" min="1" max="50" value="25" style="width:70px;" />
          <button type="button" id="audit-start-btn">Spustit audit</button>
        </div>
      </section>
      <section id="audit-current-card" class="seo-job-card" style="display:none;">
        <h3>Aktuální audit</h3>
        <p id="audit-job-id"></p>
        <p id="audit-status-line"></p>
        <p id="audit-pages-line"></p>
        <div id="audit-progress-container" style="display:none; margin-top:12px;">
          <div style="display:flex; justify-content:space-between; margin-bottom:4px; font-size:13px; color:#94a3b8;">
            <span>Progress</span>
            <span id="audit-progress-text">0%</span>
          </div>
          <div style="width:100%; height:8px; background:#020617; border-radius:4px; overflow:hidden; border:1px solid #1e293b;">
            <div id="audit-progress-bar" style="width:0%; height:100%; background:#2563eb; transition:width 0.3s ease;"></div>
          </div>
        </div>
        <div id="audit-result-wrap" class="audit-report" style="display:none;"></div>
      </section>
      <section class="seo-history">
        <h3>Historie auditů</h3>
        <div id="audit-history-loading" class="spinner" style="display:none;"></div>
        <div class="seo-table-wrap">
          <table class="seo-table">
            <thead>
              <tr><th>Vytvořeno</th><th>URL</th><th>Stav</th><th>Stránky</th><th>Akce</th></tr>
            </thead>
            <tbody id="audit-history-tbody"></tbody>
          </table>
        </div>
      </section>
    </div>
  </div>

  <div id="publish-panel" class="panel">
    <div class="tip">Připojení k platformám a správa publikací. Schválený obsah se publikuje jako draft.</div>
    <div class="seo-content">
      <div id="publish-banner" class="banner" style="display:none;"></div>
      <section class="publish-connections">
        <h3>Connections</h3>
        <div class="publish-card" id="wp-card">
          <h4 style="margin:0 0 12px 0; font-size:14px; color:#94a3b8;">WordPress</h4>
          <div id="wp-connect-form">
            <div class="form-row">
              <label>Base URL</label>
              <input type="url" id="wp-base-url" placeholder="https://example.com" />
            </div>
            <div class="form-row">
              <label>Username</label>
              <input type="text" id="wp-username" placeholder="admin" />
            </div>
            <div class="form-row">
              <label>Application Password</label>
              <input type="password" id="wp-app-password" placeholder="xxxx xxxx xxxx xxxx" />
            </div>
            <button type="button" id="wp-connect-btn">Connect</button>
          </div>
          <div id="wp-connected" style="display:none;">
            <p id="wp-connected-info" style="margin:0 0 10px 0; font-size:14px;"></p>
            <button type="button" id="wp-disconnect-btn" class="secondary">Disconnect</button>
          </div>
        </div>
      </section>
      <section class="seo-history">
        <h3>Publish actions</h3>
        <div id="publish-list-loading" class="spinner" style="display:none;"></div>
        <div class="seo-table-wrap">
          <table class="seo-table">
            <thead>
              <tr><th>Vytvořeno</th><th>Platform</th><th>Entity</th><th>Stav</th><th>Result</th></tr>
            </thead>
            <tbody id="publish-list-tbody"></tbody>
          </table>
        </div>
      </section>
    </div>
  </div>

  <div id="marketing-panel" class="panel">
    <div class="tip">Vygeneruj marketingový leták s AI designem. Text se renderuje programově pro správnou diakritiku.</div>
    <div class="seo-content">
      <div id="marketing-banner" class="banner" style="display:none;"></div>
      <section class="seo-form-section">
        <div style="display:flex;flex-direction:column;gap:16px;">
          <div>
            <label style="display:block;color:#94a3b8;font-size:13px;margin-bottom:4px;">Obor</label>
            <input type="text" id="marketing-industry" placeholder="např. cukrárna, truhlář, kadeřnictví" style="width:100%;max-width:400px;" />
          </div>
          <div>
            <label style="display:block;color:#94a3b8;font-size:13px;margin-bottom:4px;">Název značky</label>
            <input type="text" id="marketing-brand-name" placeholder="Název firmy" style="width:100%;max-width:400px;" />
          </div>
          <div style="display:flex;gap:12px;flex-wrap:wrap;">
            <div>
              <label style="display:block;color:#94a3b8;font-size:13px;margin-bottom:4px;">Hlavní barva</label>
              <input type="color" id="marketing-brand-primary" value="#2563eb" style="width:80px;height:40px;border:none;border-radius:8px;cursor:pointer;" />
            </div>
            <div>
              <label style="display:block;color:#94a3b8;font-size:13px;margin-bottom:4px;">Akcentní barva</label>
              <input type="color" id="marketing-brand-accent" value="#7c3aed" style="width:80px;height:40px;border:none;border-radius:8px;cursor:pointer;" />
            </div>
          </div>
          <div>
            <label style="display:block;color:#94a3b8;font-size:13px;margin-bottom:4px;">Headline</label>
            <input type="text" id="marketing-headline" placeholder="Hlavní nadpis nabídky" style="width:100%;max-width:600px;" />
          </div>
          <div>
            <label style="display:block;color:#94a3b8;font-size:13px;margin-bottom:4px;">Subheadline (volitelné)</label>
            <input type="text" id="marketing-subheadline" placeholder="Podnadpis" style="width:100%;max-width:600px;" />
          </div>
          <div>
            <label style="display:block;color:#94a3b8;font-size:13px;margin-bottom:4px;">Bullets (každý na nový řádek, max 5)</label>
            <textarea id="marketing-bullets" placeholder="Výhoda 1&#10;Výhoda 2&#10;Výhoda 3" style="width:100%;max-width:600px;min-height:100px;padding:12px;border-radius:8px;border:1px solid #1e293b;background:#020617;color:#e5e7eb;font-size:14px;"></textarea>
          </div>
          <div>
            <label style="display:block;color:#94a3b8;font-size:13px;margin-bottom:4px;">CTA text</label>
            <input type="text" id="marketing-cta" placeholder="Zjistit více" value="Zjistit více" style="width:100%;max-width:400px;" />
          </div>
          <div>
            <label style="display:block;color:#94a3b8;font-size:13px;margin-bottom:4px;">Formát</label>
            <select id="marketing-format" style="width:200px;padding:12px;border-radius:8px;border:1px solid #1e293b;background:#020617;color:#e5e7eb;">
              <option value="ig_post">Instagram Post (1080x1350)</option>
              <option value="ig_story">Instagram Story (1080x1920)</option>
            </select>
          </div>
          <button type="button" id="marketing-generate-btn">Vygenerovat leták</button>
        </div>
      </section>
      <section id="marketing-current-card" class="seo-job-card" style="display:none;">
        <h3>Aktuální leták</h3>
        <p id="marketing-current-jobid"></p>
        <p id="marketing-current-status"></p>
        <div id="marketing-progress-container" style="display:none; margin-top:12px;">
          <div style="display:flex; justify-content:space-between; margin-bottom:4px; font-size:13px; color:#94a3b8;">
            <span>Progress</span>
            <span id="marketing-progress-text">0%</span>
          </div>
          <div style="width:100%; height:8px; background:#020617; border-radius:4px; overflow:hidden; border:1px solid #1e293b;">
            <div id="marketing-progress-bar" style="width:0%; height:100%; background:#2563eb; transition:width 0.3s ease;"></div>
          </div>
        </div>
        <div id="marketing-result-wrap" style="display:none;margin-top:16px;">
          <img id="marketing-result-image" src="" alt="Generated flyer" style="max-width:100%;border-radius:8px;border:1px solid #1e293b;" />
          <div style="margin-top:12px;">
            <button type="button" id="marketing-download-btn" class="secondary">Stáhnout PNG</button>
          </div>
        </div>
      </section>
    </div>
  </div>

  <div id="history-panel" class="panel">
    <div class="tip">Historie akcí (localStorage, max 100).</div>
    <div class="seo-content" style="padding:20px;">
      <div id="history-list" class="history-list"></div>
    </div>
  </div>

  <div id="outputs-panel" class="panel">
    <div class="tip">Výstupy z API (content, design, flyer). Klikni „Pokračovat v chatu“ pro návaznost.</div>
    <div class="seo-content" style="padding:20px;">
      <div id="outputs-loading" class="spinner" style="display:none;"></div>
      <div class="seo-table-wrap">
        <table class="seo-table">
          <thead>
            <tr><th>Typ</th><th>Vytvořeno</th><th>Shrnutí</th><th>Akce</th></tr>
          </thead>
          <tbody id="outputs-tbody"></tbody>
        </table>
      </div>
      <p id="outputs-empty" style="display:none; color:#94a3b8;">Žádné výstupy.</p>
    </div>
  </div>
</div>

<div id="history-modal" class="modal-overlay" style="display:none;">
  <div class="modal">
    <h3>Detail záznamu</h3>
    <pre id="history-detail-body" style="white-space:pre-wrap; font-size:12px; max-height:400px; overflow:auto;"></pre>
    <div class="modal-actions">
      <button type="button" id="history-copy-json" class="secondary">Copy JSON</button>
      <button type="button" id="history-download-json" class="secondary">Download JSON</button>
      <button type="button" id="history-modal-close" class="secondary">Zavřít</button>
    </div>
  </div>
</div>

<div id="modal-api-error" class="modal-overlay" style="display:none;">
  <div class="modal">
    <h3 id="modal-api-error-title">Chyba</h3>
    <p id="modal-api-error-msg"></p>
    <div class="modal-actions">
      <button type="button" id="modal-api-error-primary">Přejít do Dashboardu</button>
      <button type="button" id="modal-api-error-close" class="secondary" style="display:none;">Zavřít</button>
    </div>
  </div>
</div>

<script src="js/api.js"></script>
<script src="js/jobPoller.js"></script>
<script src="js/history.js"></script>
<script src="dashboard.js"></script>
<script src="history-page.js"></script>
<script src="chat.js"></script>
<script src="seo.js"></script>
<script src="seoAudit.js"></script>
<script src="publish.js"></script>
<script src="marketing.js"></script>
<script src="outputs.js"></script>

</body>
</html>
